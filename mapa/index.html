<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Mapa Sanitário – Escolas Municipais</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<style>
body { margin:0; font-family: Arial, sans-serif; }

header {
  background:#1f4fd8;
  color:#fff;
  padding:12px;
  text-align:center;
  font-weight:bold;
}

#map { height: calc(100vh - 120px); }

.painel {
  padding:10px;
  background:#f4f6f8;
  display:flex;
  gap:15px;
  justify-content:center;
  font-size:14px;
}

.painel label {
  display:flex;
  align-items:center;
  gap:6px;
  cursor:pointer;
}

.bola {
  width:12px;
  height:12px;
  border-radius:50%;
  display:inline-block;
}
.verde { background:green; }
.laranja { background:orange; }
.vermelho { background:red; }
</style>
</head>

<body>

<header>
Mapa Sanitário das Escolas – Secretaria de Educação
</header>

<div class="painel">
  <label><input type="checkbox" id="filtroAdequado" checked>
    <span class="bola verde"></span> Adequado
  </label>

  <label><input type="checkbox" id="filtroAlerta" checked>
    <span class="bola laranja"></span> Alerta
  </label>

  <label><input type="checkbox" id="filtroCritico" checked>
    <span class="bola vermelho"></span> Crítico
  </label>
</div>

<div id="map"></div>

<script>
const API_URL ="https://script.google.com/macros/s/AKfycbwdAy2jS1QhXKC4qaJwnlmEx_mM2tDX1lxbcVrInyngBrC6ICBHONlTfRsZ9q6aWGPB/exec";

// Mapa
const map = L.map("map").setView([-3.7319, -38.5267], 12);

L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
  attribution: "© OpenStreetMap"
}).addTo(map);

// Camadas por status
const camadaAdequado = L.layerGroup().addTo(map);
const camadaAlerta = L.layerGroup().addTo(map);
const camadaCritico = L.layerGroup().addTo(map);

// Função status → camada
function camadaPorStatus(status) {
  if (status.includes("crítica")) return camadaCritico;
  if (status.includes("alerta")) return camadaAlerta;
  return camadaAdequado;
}

function corPorStatus(status) {
  if (status.includes("crítica")) return "red";
  if (status.includes("alerta")) return "orange";
  return "green";
}

// Carregar dados
fetch(API_URL)
  .then(res => res.json())
  .then(dados => {
    dados.forEach(e => {
      if (!e.lat || !e.lng) return;

      const layer = camadaPorStatus(e.status);
      const cor = corPorStatus(e.status);

      L.circleMarker([e.lat, e.lng], {
        radius: 8,
        color: cor,
        fillColor: cor,
        fillOpacity: 0.8
      })
      .bindPopup(`
        <strong>${e.escola}</strong><br>
        Status: ${e.status}<br>
        Pontuação: ${e.pontuacao}
      `)
      .addTo(layer);
    });
  });

// Filtros
document.getElementById("filtroAdequado").addEventListener("change", e => {
  e.target.checked ? map.addLayer(camadaAdequado) : map.removeLayer(camadaAdequado);
});

document.getElementById("filtroAlerta").addEventListener("change", e => {
  e.target.checked ? map.addLayer(camadaAlerta) : map.removeLayer(camadaAlerta);
});

document.getElementById("filtroCritico").addEventListener("change", e => {
  e.target.checked ? map.addLayer(camadaCritico) : map.removeLayer(camadaCritico);
});
</script>

</body>
</html>
